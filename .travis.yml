sudo: required
dist: xenial  # fails with trusty (the travis default)
language: bash
services:
  - docker
install:
  - sudo apt-get update
  - sudo apt-get install --yes --no-install-recommends libguestfs-tools qemu-user-static binfmt-support debian-archive-keyring
# kernel images in /boot are only readable by root and thus guestfish breaks...
# https://bugs.launchpad.net/ubuntu/+source/linux/+bug/759725
# https://bugs.launchpad.net/ubuntu/+source/libguestfs/+bug/1813662
before_script:
  - sudo chmod o+r /boot/*
script:
  - ./buildimg.sh
before_deploy:
 - /usr/bin/time xz -9ve raspi3.img
# deploy section generated by:
# GEM_HOME="$HOME/.gems" "$HOME/.gems/bin/travis" setup releases
deploy:
  provider: releases
  api_key:
    secure: jktR6H1K59Qa5b5YYfjRgGbq+IDqIs/5LZ0JdkjR3BOEdKSNxn4o8tMm7WuNbz3LF3sAxldWxt9BYmcfh/OvkbFE8EdjLlYV86xNgb7vR0CsEqJXyufzOTkVwQunGhBk6QlRV7bG8fszzc9Aw3tayxRy2A4zJh2Ptcx42q28K0GKXSxcj0bgF9Wsihypagwn/4pCCqNCPaBBUT4+E2gHvIg1uUsns6Xer9nRjli6IYnfKZr+tB937Dzd1ig+a/8lCi0FTmZhxqh5hKpJZsfasHGV9JPkelN6eJW9d5mfP8yvpQjqWzBGDh2ihw3ww7H8D3Tsfurk/CqvUbDy5JaSV85lU/85pbq7l2SiP8z8akOXA5woak2yHP68GMThoclnyHLmz20TWHPUIIRw08EPNodaU3X2wkfGIPbD0yiBqnBMna1q3lLbNT0LhjZ4JzJEqx1j3D/G0nSxPrKm+oO8vmSczF9F9qm9IGMEWlZU0mGtDbKgePZcBSpm0uUW7gxfNsRtGBPgk+YWX8k0AwizE8LJUw0KolRJrKB4ASzcoRPVA2J1hafoJWZ+L44ERG700JLfhPC/iO5ZVMqzYKFXQvYFV5E/fjnmJ+XKDwO93cj5K00QRoKwY0M+9MLjkGLGQ9OhqGEvT1BpvhaeXxj7pnOteYLTaruYWsiHeLQBhdk=
  file: raspi3.img.xz
  on:
    repo: 3DTK/irma3d
    tags: true
  skip_cleanup: true
  # overwrite: true
